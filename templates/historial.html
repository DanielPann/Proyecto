<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Historial de Predicciones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="container mt-5">
    <h1 class="text-center mb-4">Historial de Predicciones</h1>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Ciclistas (%)</th>
                <th>Fumadores (%)</th>
                <th>Resultado</th>
            </tr>
        </thead>
        <tbody>
            {% for r in registros %}
            <tr>
                <td>{{ r.fecha.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>{{ r.ciclistas }}</td>
                <td>{{ r.fumadores }}</td>
                <td>{{ r.resultado }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <canvas id="grafica" height="100"></canvas>

    <script>
        const labels = {{ registros|map(attribute='fecha.strftime("%H:%M:%S")')|list }};
        const data = {
            labels: labels,
            datasets: [{
                label: 'Predicciones',
                data: {{ registros|map(attribute='resultado')|list }},
                borderColor: 'rgb(75, 192, 192)',
                fill: false,
                tension: 0.1
            }]
        };

        const config = {
            type: 'line',
            data: data
        };

        new Chart(document.getElementById('grafica'), config);
    </script>
</body>
</html>
